<!doctype html>
<html>
<head>
  <!--
    back/public/holds.html
    - UI to list and clear 'hold' deductions created during payroll runs
    - Calls GET /api/payroll/holds and POST /api/payroll/holds/clear
  -->
  <meta charset="utf-8" /><title>Holds</title></head>
<body>
  <h1>Holds (10-day)</h1>
  <label>Month: <input id="month" value="2026-01" /></label>
  <button id="load">Load</button>
  <div id="list"></div>
  <script>
    const list = document.getElementById('list');
    document.getElementById('load').onclick = async () => {
      const month = document.getElementById('month').value;
      const res = await fetch('/api/payroll/holds?month=' + encodeURIComponent(month));
      const json = await res.json();
      list.innerHTML = json.map(h => `ID: ${h._id} - Employee: ${h.employee ? h.employee.name : h.employee} - Amount: ${h.amount} <button data-id="${h._id}">Clear</button>`).join('<br/>');
      list.querySelectorAll('button[data-id]').forEach(btn => btn.onclick = async (e) => {
        const id = e.target.getAttribute('data-id');
        const res = await fetch('/api/payroll/holds/clear', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ deductionId: id }) });
        const r = await res.json();
        alert(JSON.stringify(r));
        document.getElementById('load').click();
      });
    }
  </script>
</body>
</html>